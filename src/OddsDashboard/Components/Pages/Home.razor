@page "/"
@using OddsDashboard.Shared.ViewModels
@using OddsDashboard.Services
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@inject IRefreshService RefreshService
@implements IDisposable

<GameSection Title="Live" Games="@_viewModel?.LiveGames" />
<GameSection Title="Upcoming" Games="@_viewModel?.UpcomingGames" />

@code
{
    private HomeViewModel? _viewModel;
    
    protected override void OnInitialized()
    {
        _viewModel = RefreshService.HomeViewModel;
        RefreshService.DataRefreshed += RefreshDashboard;
    }
    
    private void RefreshDashboard(HomeViewModel homeViewModel)
    {
        _ = InvokeAsync(() =>
        {
            _viewModel = homeViewModel;
            StateHasChanged();
        });
    }
    
    public void Dispose()
    {
        RefreshService.DataRefreshed -= RefreshDashboard;
    }
}
