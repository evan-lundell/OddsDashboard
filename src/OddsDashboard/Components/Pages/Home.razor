@page "/"
@using OddsDashboard.Shared.ViewModels
@using OddsDashboard.Services
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@inject IRefreshService RefreshService
@implements IDisposable

@if (_viewModel == null)
{
    <Skeleton />
}
else
{
    <GameSection Title="Live" Games="@_viewModel.LiveGames" />
    <GameSection Title="Upcoming" Games="@_viewModel.UpcomingGames" />
}

@code
{
    private HomeViewModel? _viewModel;
    
    protected override void OnInitialized()
    {
        _viewModel = RefreshService.HomeViewModel;
        RefreshService.DataRefreshed += RefreshDashboard;
    }
    
    private void RefreshDashboard(HomeViewModel homeViewModel)
    {
        _viewModel = homeViewModel;
    }
    
    public void Dispose()
    {
        RefreshService.DataRefreshed -= RefreshDashboard;
    }
}
